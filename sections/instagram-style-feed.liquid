{% liquid
  assign slide_count = section.blocks.size

  if section.settings.section_width == 'page-width'
    assign slideshow_gutters = 'start end'
  else
    assign slideshow_gutters = null
  endif
%}

<div class="section-background color-{{ section.settings.color_scheme }}"></div>

<section
  class="section section--{{ section.settings.section_width }} color-{{ section.settings.color_scheme }} spacing-style instagram-style-feed"
  style="
    {% render 'spacing-style', settings: section.settings %}
    --feed-columns: {{ section.settings.columns }};
    --feed-gap: {{ section.settings.columns_gap }}px;
    --feed-mobile-card-width: {{ section.settings.mobile_card_width }}px;
    --feed-slide-max-width: {{ section.settings.slide_max_width }}px;
  "
  data-testid="instagram-style-feed"
>
  <header class="instagram-style-feed__header">
    <div class="instagram-style-feed__title rte">{{ section.settings.heading }}</div>
    <div class="instagram-style-feed__subtitle rte">{{ section.settings.subtitle }}</div>
  </header>

  {% if slide_count > 0 %}
    {% capture slides %}
      {% for block in section.blocks %}
        {% capture feed_item %}
          {% if block.settings.link != blank %}
            <a
              class="instagram-style-feed__card"
              href="{{ block.settings.link }}"
              {% if block.settings.open_in_new_tab %}
                target="_blank" rel="noopener noreferrer"
              {% endif %}
              {{ block.shopify_attributes }}
            >
              {% if block.settings.image != blank %}
                {{
                  block.settings.image
                  | image_url: width: 1400
                  | image_tag:
                    class: 'instagram-style-feed__image',
                    widths: '300, 450, 600, 800, 1000, 1200, 1400',
                    sizes: '(min-width: 750px) 20vw, 65vw',
                    loading: 'lazy',
                    alt: block.settings.alt | default: block.settings.image.alt | escape
                }}
              {% else %}
                {{ 'image' | placeholder_svg_tag: 'instagram-style-feed__image instagram-style-feed__image--placeholder placeholder-svg' }}
              {% endif %}
            </a>
          {% else %}
            <div class="instagram-style-feed__card" {{ block.shopify_attributes }}>
              {% if block.settings.image != blank %}
                {{
                  block.settings.image
                  | image_url: width: 1400
                  | image_tag:
                    class: 'instagram-style-feed__image',
                    widths: '300, 450, 600, 800, 1000, 1200, 1400',
                    sizes: '(min-width: 750px) 20vw, 65vw',
                    loading: 'lazy',
                    alt: block.settings.alt | default: block.settings.image.alt | escape
                }}
              {% else %}
                {{ 'image' | placeholder_svg_tag: 'instagram-style-feed__image instagram-style-feed__image--placeholder placeholder-svg' }}
              {% endif %}
            </div>
          {% endif %}
        {% endcapture %}

        {% render 'slideshow-slide', index: forloop.index0, class: 'instagram-style-feed__slide', children: feed_item %}
      {% endfor %}
    {% endcapture %}

    <div class="instagram-style-feed__carousel-wrapper">
      {% render 'slideshow',
        ref: 'instagramStyleFeed',
        class: 'instagram-style-feed__carousel',
        slides: slides,
        show_arrows: section.settings.icons_style != 'none',
        icon_style: section.settings.icons_style,
        icon_shape: section.settings.icons_shape,
        auto_hide_controls: false,
        infinite: false,
        initial_slide: 0,
        slide_count: slide_count,
        slideshow_gutters: slideshow_gutters
      %}
    </div>
  {% endif %}
</section>

{% stylesheet %}
  .instagram-style-feed {
    overflow-x: hidden;
  }

  .instagram-style-feed__header {
    max-width: 48rem;
    margin-inline: auto;
    text-align: center;
  }

  .instagram-style-feed__title > * {
    margin: 0;
  }

  .instagram-style-feed__subtitle > * {
    margin: 0.5rem 0 0;
  }

  .instagram-style-feed__carousel-wrapper {
    width: 100%;
    position: relative;
    padding: 56px 0 0;
  }

  .instagram-style-feed__carousel .slideshow-control[disabled] {
    display: block;
  }

  .instagram-style-feed__carousel slideshow-arrows {
    left: unset;
    right: 0;
    top: -42px;
    height: 30px;
    justify-content: normal;
    opacity: 1;
    display: flex !important;

    .slideshow-control {
      opacity: 1;
      margin: 0;
      animation: none !important;

      &:disabled {
        opacity: 0.5;
      }

      svg,
      .svg-wrapper {
        width: 30px;
        height: 30px;
      }

      path {
        stroke-width: 1px;
      }
    }
  }


  .instagram-style-feed__carousel .slideshow-control--next {
    margin-inline-start: auto;
  }

  .instagram-style-feed__carousel slideshow-slides {
    gap: var(--feed-gap);
  }

  .instagram-style-feed__slide {
    width: min(
      calc((100% - ((var(--feed-columns) - 1) * var(--feed-gap))) / var(--feed-columns)),
      var(--feed-slide-max-width)
    );
    min-width: 0;
    flex: 0 0 auto;
    scroll-snap-align: start;
  }

  .instagram-style-feed__card {
    display: block;
    color: inherit;
    text-decoration: none;
    overflow: hidden;
  }

  .instagram-style-feed__image {
    width: 100%;
    aspect-ratio: 4 / 5;
    object-fit: cover;
    display: block;
    background: rgb(var(--color-foreground) / 6%);
  }

  .instagram-style-feed__image--placeholder {
    padding: 2rem;
  }

  @media screen and (max-width: 749px) {
    .instagram-style-feed__slide {
      width: min(var(--feed-mobile-card-width), 78vw);
    }
  }
{% endstylesheet %}

{% schema %}
{
  "name": "Feed Instagram Manual",
  "class": "section-instagram-style-feed",
  "disabled_on": {
    "groups": ["header", "footer"]
  },
  "settings": [
    {
      "type": "richtext",
      "id": "heading",
      "label": "Titulo",
      "default": "<p><strong>Ãšsalos a tu manera</strong></p>"
    },
    {
      "type": "richtext",
      "id": "subtitle",
      "label": "Subtitulo",
      "default": "<p>Comparte tu estilo con el mundo, etiqueta a @drmartensofficial</p>"
    },
    {
      "type": "header",
      "content": "Carrusel"
    },
    {
      "type": "range",
      "id": "columns",
      "label": "Columnas en desktop",
      "min": 2,
      "max": 8,
      "step": 1,
      "default": 5
    },
    {
      "type": "range",
      "id": "columns_gap",
      "label": "Espacio entre imagenes",
      "min": 0,
      "max": 48,
      "step": 1,
      "unit": "px",
      "default": 8
    },
    {
      "type": "range",
      "id": "mobile_card_width",
      "label": "Ancho tarjeta en movil",
      "min": 180,
      "max": 420,
      "step": 5,
      "unit": "px",
      "default": 260
    },
    {
      "type": "range",
      "id": "slide_max_width",
      "label": "Ancho maximo por imagen",
      "min": 120,
      "max": 500,
      "step": 5,
      "unit": "px",
      "default": 360
    },
    {
      "type": "header",
      "content": "Navegacion"
    },
    {
      "type": "select",
      "id": "icons_style",
      "label": "Icono de flechas",
      "options": [
        {
          "value": "arrow",
          "label": "Flechas"
        },
        {
          "value": "chevron",
          "label": "Chevrons"
        },
        {
          "value": "arrows_large",
          "label": "Flechas grandes"
        },
        {
          "value": "chevron_large",
          "label": "Chevrons grandes"
        },
        {
          "value": "none",
          "label": "Sin flechas"
        }
      ],
      "default": "arrow"
    },
    {
      "type": "select",
      "id": "icons_shape",
      "label": "Fondo del icono",
      "options": [
        {
          "value": "none",
          "label": "Ninguno"
        },
        {
          "value": "circle",
          "label": "Circulo"
        },
        {
          "value": "square",
          "label": "Cuadrado"
        }
      ],
      "default": "none",
      "visible_if": "{{ section.settings.icons_style != 'none' }}"
    },
    {
      "type": "header",
      "content": "Apariencia"
    },
    {
      "type": "select",
      "id": "section_width",
      "label": "Ancho de seccion",
      "options": [
        {
          "value": "page-width",
          "label": "Pagina"
        },
        {
          "value": "full-width",
          "label": "Completo"
        }
      ],
      "default": "full-width"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Esquema de color",
      "default": "scheme-1"
    },
    {
      "type": "header",
      "content": "Espaciado"
    },
    {
      "type": "range",
      "id": "padding-block-start",
      "label": "Arriba",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 32
    },
    {
      "type": "range",
      "id": "padding-block-end",
      "label": "Abajo",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 32
    },
    {
      "type": "header",
      "content": "Espaciado movil"
    },
    {
      "type": "range",
      "id": "padding-block-start-mobile",
      "label": "Arriba (movil)",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 24
    },
    {
      "type": "range",
      "id": "padding-block-end-mobile",
      "label": "Abajo (movil)",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 24
    },
    {
      "type": "range",
      "id": "padding-inline-start-mobile",
      "label": "Izquierda (movil)",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding-inline-end-mobile",
      "label": "Derecha (movil)",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 0
    }
  ],
  "blocks": [
    {
      "type": "feed_image",
      "name": "Imagen del feed",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Imagen"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Link"
        },
        {
          "type": "checkbox",
          "id": "open_in_new_tab",
          "label": "Abrir en nueva pestana",
          "default": true,
          "visible_if": "{{ block.settings.link != blank }}"
        },
        {
          "type": "text",
          "id": "alt",
          "label": "Texto alternativo"
        }
      ]
    }
  ],
  "max_blocks": 24,
  "presets": [
    {
      "name": "Feed Instagram Manual",
      "category": "Storytelling",
      "blocks": {
        "feed_1": {
          "type": "feed_image"
        },
        "feed_2": {
          "type": "feed_image"
        },
        "feed_3": {
          "type": "feed_image"
        },
        "feed_4": {
          "type": "feed_image"
        },
        "feed_5": {
          "type": "feed_image"
        }
      },
      "block_order": ["feed_1", "feed_2", "feed_3", "feed_4", "feed_5"]
    }
  ]
}
{% endschema %}
