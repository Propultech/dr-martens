{%- doc -%}
  Renders a default variant picker, used to display the variant picker in the variants block.

  @param {object} product_resource - The product object.
  @param {object} [block] - The block object
{%- enddoc -%}

{% assign block_settings = block.settings %}

{% unless product_resource.has_only_default_variant %}
  {% liquid
    assign button_background_brightness = section.settings.color_scheme.settings.foreground | color_brightness
    if button_background_brightness < 105
      assign strikethrough_color_mix = '#000'
    else
      assign strikethrough_color_mix = '#fff'
    endif

    assign size_guide_enabled = false
    assign color_options_enabled = false
    if block_settings.enable_size_guide and block_settings.size_guide_page != blank
      assign size_option_aliases = block_settings.size_guide_option_names | default: 'size,talla,talle' | split: ','
      for product_option in product_resource.options_with_values
        assign option_name_handle = product_option.name | handleize
        for size_option_alias in size_option_aliases
          assign alias_handle = size_option_alias | strip | handleize
          if alias_handle != blank and option_name_handle contains alias_handle
            assign size_guide_enabled = true
            break
          endif
        endfor
        if size_guide_enabled
          break
        endif
      endfor
    endif

    if block_settings.enable_color_options_modal and block_settings.color_options_page != blank
      assign color_option_aliases = block_settings.color_options_option_names | default: 'color,colour,colorway' | split: ','
      for product_option in product_resource.options_with_values
        assign option_name_handle = product_option.name | handleize
        for color_option_alias in color_option_aliases
          assign alias_handle = color_option_alias | strip | handleize
          if alias_handle != blank and option_name_handle contains alias_handle
            assign color_options_enabled = true
            break
          endif
        endfor
        if color_options_enabled
          break
        endif
      endfor
    endif
  %}
  {% if size_guide_enabled or color_options_enabled %}
    <script
      src="{{ 'dialog.js' | asset_url }}"
      type="module"
    ></script>
  {% endif %}
  <variant-picker
    class="variant-picker spacing-style variant-picker--{{ block_settings.alignment }}"
    style="--color-strikethrough-mix: {{ strikethrough_color_mix }}; {% render 'spacing-style', settings: block_settings %}"
    data-section-id="{{ section.id }}"
    data-product-id="{{ product_resource.id }}"
    data-block-id="{{ block.id }}"
    data-product-url="{{ product_resource.url }}"
    ref="mainVariantPicker"
    {% if product.id == product_resource.id %}
      data-template-product-match="true"
    {% endif %}
    {{ block.shopify_attributes }}
    {% if request.visual_preview_mode %}
      data-shopify-visual-preview
    {% endif %}
  >
    <form class="variant-picker__form">
      {%- for product_option in product_resource.options_with_values -%}
        {%- liquid
          assign swatch_count = product_option.values | map: 'swatch' | compact | size
          assign variant_style = block_settings.variant_style
          assign option_name_handle = product_option.name | handleize
          assign show_size_guide = false
          assign option_id_attribute = ''
          assign fieldset_id = ''
          assign longest_value = 0
          assign show_color_options = false

          if swatch_count > 0 and block_settings.show_swatches
            if block_settings.variant_style == 'dropdown'
              assign variant_style = 'swatch_dropdown'
            else
              assign variant_style = 'swatch'
            endif
          endif

          if variant_style == 'buttons' and settings.variant_button_width == 'equal-width-buttons'
            assign fieldset_id = section.id | append: '-' | append: product_resource.id | append: '-' | append: product_option.name | handleize
            assign option_id_attribute = 'data-option-id="' | append: fieldset_id | append: '"'
          endif

          if block_settings.enable_size_guide and block_settings.size_guide_page != blank
            assign size_option_aliases = block_settings.size_guide_option_names | default: 'size,talla,talle' | split: ','
            for size_option_alias in size_option_aliases
              assign alias_handle = size_option_alias | strip | handleize
              if alias_handle != blank and option_name_handle contains alias_handle
                assign show_size_guide = true
                break
              endif
            endfor
          endif

          if variant_style == 'swatch' and block_settings.enable_color_options_modal and block_settings.color_options_page != blank
            assign color_option_aliases = block_settings.color_options_option_names | default: 'color,colour,colorway' | split: ','
            for color_option_alias in color_option_aliases
              assign alias_handle = color_option_alias | strip | handleize
              if alias_handle != blank and option_name_handle contains alias_handle
                assign show_color_options = true
                break
              endif
            endfor
          endif
        -%}

        {%- if variant_style == 'swatch' or block_settings.variant_style == 'buttons' -%}
          {%- assign fieldset_index = forloop.index0 -%}
          <fieldset
            class="variant-option variant-option--buttons{% if variant_style == 'swatch' %} variant-option--swatches{% else %} variant-option--{{ settings.variant_button_width }}{% endif %}{% if show_size_guide %} variant-option--size-guide{% endif %}{% if show_color_options %} variant-option--color-options{% endif %}"
            data-fieldset-index="{{ fieldset_index }}"
            ref="fieldsets[]"
            {{ option_id_attribute }}
          >
            <legend>
              {{ product_option.name | escape -}}:
              {%- if variant_style == 'swatch' -%}
                <span class="variant-option__swatch-value">{{ product_option.selected_value }}</span>
              {%- endif %}
            </legend>
            {% if show_size_guide %}
              <dialog-component class="variant-size-guide">
                <div class="variant-size-guide__header">
                  <span class="variant-size-guide__title">{{ block_settings.size_guide_title | default: product_option.name | escape }}</span>
                  <button
                    class="button button-unstyled variant-size-guide__link"
                    type="button"
                    on:click="/showDialog"
                  >
                    {{ block_settings.size_guide_link_label | default: 'Guia de tallas' | escape }}
                  </button>
                </div>
                {% if block_settings.size_guide_message != blank %}
                  <div class="variant-size-guide__message rte">{{ block_settings.size_guide_message }}</div>
                {% endif %}
                <div class="variant-size-guide__options">
                  {%- for product_option_value in product_option.values -%}
                    {% if product_option_value.size > longest_value and option_id_attribute %}
                      {% assign longest_value = product_option_value.size %}
                    {% endif %}
                    <label
                      class="variant-option__button-label{% if variant_style == 'swatch' %} variant-option__button-label--has-swatch{% endif %}"
                    >
                      <input
                        type="radio"
                        name="{{ product_option.name | escape }}-{{ block.id }}-{{ product_resource.id }}"
                        value="{{ product_option_value | escape }}"
                        aria-label="{{ product_option_value.name }}"
                        {% if product_option_value.available == false %}
                          aria-disabled="true"
                        {% endif %}
                        data-previous-checked="false"
                        data-fieldset-index="{{ fieldset_index }}"
                        data-input-index="{{ forloop.index0 }}"
                        data-input-id="{{ product_option.position }}-{{ forloop.index0 }}"
                        data-option-value-id="{{ product_option_value.id }}"
                        data-option-available="{{ product_option_value.available }}"
                        data-connected-product-url="{{ product_option_value.product_url }}"
                        {% if product_option_value.variant.id %}
                          data-variant-id="{{ product_option_value.variant.id }}"
                        {% endif %}
                        {% if product_option_value.selected %}
                          data-current-checked="true"
                          checked
                        {% else %}
                          data-current-checked="false"
                        {% endif %}
                      >
                      {% if variant_style == 'swatch' %}
                        {% liquid
                          assign featured_media = product_option_value.variant.featured_media

                          # If the variant has no featured media, and we have a combined listing product, then fall back to
                          # using the featured media of the child product that is linked to this option value.
                          if featured_media == blank and product_option_value.product_url
                            assign featured_media = product_option_value.variant.product.featured_media
                          endif
                        %}

                        {% render 'swatch',
                          swatch: product_option_value.swatch,
                          variant_image: featured_media,
                          mode: 'unscaled',
                          context: 'pdp'
                        %}
                      {% else %}
                        {% if product_option_value.available == true %}
                          <span
                            class="variant-option__button-label__pill"
                            data-key="variant-option-pill"
                          ></span>
                        {% endif %}
                        <span
                          class="variant-option__button-label__text"
                          data-key="variant-option-text"
                        >
                          {{- product_option_value | escape -}}
                        </span>
                      {% endif %}
                      {% render 'strikethrough-variant', product_option: product_option_value %}
                    </label>
                  {%- endfor -%}
                  {% if block_settings.size_guide_show_icon_button %}
                    <button
                      type="button"
                      class="button button-unstyled variant-option__button-label variant-option__button-label--size-guide-modal"
                      on:click="/showDialog"
                      aria-label="{{ block_settings.size_guide_link_label | default: 'Guia de tallas' | escape }}"
                    >
                      <span class="variant-size-guide__icon-svg">
                        {{ 'icon-size.svg' | inline_asset_content }}
                      </span>
                    </button>
                  {% endif %}
                </div>
                <dialog
                  ref="dialog"
                  class="dialog-modal variant-size-guide__modal color-{{ settings.popover_color_scheme }}{% if block_settings.size_guide_modal_behavior == 'drawer' %} variant-size-guide__modal--drawer dialog-drawer dialog-drawer--right{% endif %}"
                  scroll-lock
                  aria-label="{{ block_settings.size_guide_title | default: product_option.name | escape }}"
                >
                  <div class="rte variant-size-guide__modal-content">
                    {{ block_settings.size_guide_page.content }}
                  </div>
                  <button
                    type="button"
                    class="button button-unstyled close-button variant-size-guide__modal-close"
                    aria-label="{{ 'actions.close' | t }}"
                    on:click="/closeDialog"
                  >
                    <span class="visually-hidden">{{ 'actions.close' | t }}</span>
                    {{ 'icon-close.svg' | inline_asset_content }}
                  </button>
                </dialog>
              </dialog-component>
            {% else %}
              {%- for product_option_value in product_option.values -%}
                {% if product_option_value.size > longest_value and option_id_attribute %}
                  {% assign longest_value = product_option_value.size %}
                {% endif %}
                <label
                  class="variant-option__button-label{% if variant_style == 'swatch' %} variant-option__button-label--has-swatch{% endif %}"
                >
                  <input
                    type="radio"
                    name="{{ product_option.name | escape }}-{{ block.id }}-{{ product_resource.id }}"
                    value="{{ product_option_value | escape }}"
                    aria-label="{{ product_option_value.name }}"
                    {% if product_option_value.available == false %}
                      aria-disabled="true"
                    {% endif %}
                    data-previous-checked="false"
                    data-fieldset-index="{{ fieldset_index }}"
                    data-input-index="{{ forloop.index0 }}"
                    data-input-id="{{ product_option.position }}-{{ forloop.index0 }}"
                    data-option-value-id="{{ product_option_value.id }}"
                    data-option-available="{{ product_option_value.available }}"
                    data-connected-product-url="{{ product_option_value.product_url }}"
                    {% if product_option_value.variant.id %}
                      data-variant-id="{{ product_option_value.variant.id }}"
                    {% endif %}
                    {% if product_option_value.selected %}
                      data-current-checked="true"
                      checked
                    {% else %}
                      data-current-checked="false"
                    {% endif %}
                  >
                  {% if variant_style == 'swatch' %}
                    {% liquid
                      assign featured_media = product_option_value.variant.featured_media

                      # If the variant has no featured media, and we have a combined listing product, then fall back to
                      # using the featured media of the child product that is linked to this option value.
                      if featured_media == blank and product_option_value.product_url
                        assign featured_media = product_option_value.variant.product.featured_media
                      endif
                    %}

                    {% render 'swatch',
                      swatch: product_option_value.swatch,
                      variant_image: featured_media,
                      mode: 'unscaled',
                      context: 'pdp'
                    %}
                  {% else %}
                    {% if product_option_value.available == true %}
                      <span
                        class="variant-option__button-label__pill"
                        data-key="variant-option-pill"
                      ></span>
                    {% endif %}
                    <span
                      class="variant-option__button-label__text"
                      data-key="variant-option-text"
                    >
                      {{- product_option_value | escape -}}
                    </span>
                  {% endif %}
                  {% render 'strikethrough-variant', product_option: product_option_value %}
                </label>
              {%- endfor -%}
            {% endif %}
            {% if show_color_options %}
              <dialog-component class="variant-color-options">
                <button
                  class="button button-unstyled variant-color-options__trigger"
                  type="button"
                  on:click="/showDialog"
                >
                  <span class="variant-color-options__trigger-text">
                    {{ block_settings.color_options_button_label | default: 'Ver más opciones' | escape }}
                  </span>
                  <span class="variant-color-options__icon" aria-hidden="true">
                    <svg viewBox="0 0 8 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M1 1L7 7L1 13" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                  </span>
                </button>
                <dialog
                  ref="dialog"
                  class="dialog-modal variant-color-options__modal color-{{ settings.popover_color_scheme }} variant-color-options__modal--drawer dialog-drawer dialog-drawer--right"
                  scroll-lock
                  aria-label="{{ block_settings.color_options_modal_title | default: 'Más opciones de color' | escape }}"
                >
                  <div class="rte variant-color-options__modal-content">
                    {{ block_settings.color_options_page.content }}
                  </div>
                  <button
                    type="button"
                    class="button button-unstyled close-button variant-color-options__modal-close"
                    aria-label="{{ 'actions.close' | t }}"
                    on:click="/closeDialog"
                  >
                    <span class="visually-hidden">{{ 'actions.close' | t }}</span>
                    {{ 'icon-close.svg' | inline_asset_content }}
                  </button>
                </dialog>
              </dialog-component>
            {% endif %}
            {% if option_id_attribute %}
              {% style %}
                [data-option-id="{{ fieldset_id }}"] {
                  --variant-ch: {{ longest_value | times: 0.65 }}em;
                }
              {% endstyle %}
            {% endif %}
          </fieldset>
        {%- elsif block_settings.variant_style == 'dropdowns' -%}
          {%
            # There is an opportunity to build a custom select component that will allow us to style the select element further (animation for dropdown, swatches shown in the dropdown options, etc)
            # It's too bad as it mean rebuilding baked in behaviours but I think we've already done that for the locale selectors
            # in dawn. So it might mean more time spent in setting it up but worth it for future updates/styling.
          %}
          {% liquid
            assign property_being_updated = false
            if settings.variant_swatch_width != settings.variant_swatch_height
              assign property_being_updated = true
              # (original width / original height) x new height (20px at the moment) = new width
              assign new_width = settings.variant_swatch_width | times: 1.0 | divided_by: settings.variant_swatch_height | times: 20
            endif
          %}

          <div class="variant-option variant-option--dropdowns">
            <label for="Option-{{ block.id }}-{{ forloop.index0 }}">{{ product_option.name | escape }}</label>
            <div
              class="variant-option__select-wrapper"
              style="
                {%- if property_being_updated  -%}
                  --variant-picker-swatch-width: clamp(10px,{{ new_width }}px, 50px);
                {%- endif -%}
              "
            >
              <select
                id="Option-{{ block.id }}-{{ forloop.index0 }}"
                name="options[{{ product_option.name | escape }}]"
                class="variant-option__select"
              >
                {%- for product_option_value in product_option.values -%}
                  <option
                    value="{{ product_option_value | escape }}"
                    data-input-id="{{ product_option.position }}-{{ forloop.index0 }}"
                    data-option-value-id="{{ product_option_value.id }}"
                    data-variant-id="{{ product_option_value.variant.id }}"
                    data-connected-product-url="{{ product_option_value.product_url }}"
                    {% if product_option_value.selected %}
                      selected="selected"
                    {% endif %}
                  >
                    {% if product_option_value.available == false %}
                      {{ product_option_value | escape }} - {{ 'content.unavailable' | t }}
                    {% else %}
                      {{ product_option_value | escape }}
                    {% endif %}
                  </option>
                {%- endfor -%}
              </select>
              <svg
                aria-hidden="true"
                focusable="false"
                class="icon icon-caret"
                viewBox="0 0 10 6"
              >
                {%- render 'icon', icon: 'caret' -%}
              </svg>
            </div>
          </div>
        {%- endif -%}
      {%- endfor -%}

      <script type="application/json">
        {{ product_resource.selected_or_first_available_variant | json }}
      </script>
    </form>
  </variant-picker>
{% endunless %}

{% stylesheet %}
  .variant-picker {
    width: 100%;
  }

  .variant-picker__form {
    width: 100%;
  }

  .variant-picker[data-shopify-visual-preview] {
    min-width: 300px;
    padding-inline-start: max(4px, var(--padding-inline-start));
  }

  .variant-option {
    --options-border-radius: var(--variant-picker-button-radius);
    --options-border-width: var(--variant-picker-button-border-width);
    --variant-option-padding-inline: var(--padding-md);
  }

  .variant-option + .variant-option {
    margin-top: 25px;
  }

  .variant-option--swatches {
    --options-border-radius: var(--variant-picker-swatch-radius);

    width: 100%;
  }

  .variant-option--swatches-disabled {
    pointer-events: none;
    cursor: not-allowed;
  }

  .variant-option--swatches > overflow-list {
    justify-content: var(--product-swatches-alignment);

    @media (max-width: 749px) {
      justify-content: var(--product-swatches-alignment-mobile);
    }
  }

  .variant-option--buttons {
    display: flex;
    flex-wrap: wrap;
    gap: var(--gap-sm);
    margin: 0;
    padding: 0;
    border: none;
  }

  .variant-option--buttons legend {
    padding: 0;
    margin-block-end: 15px;

    color: var(--color-foreground);
    font-size: var(--font-size--md);
    font-weight: var(--font-weight-ExtraBold, 800);
    line-height: 112.5%;
    letter-spacing: .25px;
    text-transform: uppercase;
  }

  .variant-option__swatch-value {
    padding-inline-start: 3px;
    font-weight: var(--font-paragraph--weight);
    line-height: 137.5%;
    text-transform: none;
  }

  @media (prefers-reduced-motion: no-preference) {
    .variant-option__button-label,
    .variant-option__select-wrapper,
    .variant-option__button-label::before,
    .variant-option__button-label::after,
    .variant-option__button-label:has([data-previous-checked='true'], [data-current-checked='true'])
      .variant-option__button-label__pill,
    .variant-option__button-label:not(.variant-option__button-label--has-swatch) svg line:last-of-type {
      transition-duration: var(--animation-speed);
      transition-timing-function: var(--animation-easing);
    }

    .variant-option__button-label__pill {
      transition-property: transform;
    }

    .variant-option__button-label:not(.variant-option__button-label--has-swatch) svg line:last-of-type {
      transition-property: clip-path;
    }

    .variant-option__button-label:has([data-previous-checked='true'], [data-current-checked='true'])
      .variant-option__button-label__pill {
      transition-property: transform;
    }

    .variant-option__button-label::after {
      transition-property: clip-path;
    }

    .variant-option__button-label::before {
      transition-property: border-color;
    }

    .variant-option__select-wrapper,
    .variant-option__button-label {
      transition-property: background-color, border-color, color;
    }
  }

  .variant-option__button-label {
    --variant-picker-stroke-color: var(--color-variant-border);

    cursor: pointer;
    display: flex;
    flex: 0 0 3.438em;
    align-items: center;
    position: relative;
    padding-block: var(--padding-sm);
    padding-inline: var(--padding-lg);
    border: var(--options-border-width) solid var(--color-variant-border);
    border-radius: var(--options-border-radius);
    overflow: clip;
    justify-content: center;
    min-height: 2.813em;
    min-width: fit-content;
    white-space: nowrap;
    background-color: var(--color-variant-background);
    color: var(--color-variant-text);

    &:hover,
    &:hover:has([aria-disabled='true']):has([data-option-available='false']) {
      background-color: var(--color-variant-hover-background);
      border-color: var(--color-variant-hover-border);
      color: var(--color-variant-hover-text);
    }

    .variant-option__strikethrough {
      transform: rotate(341deg);
    }

    /* we need something like overflow-clip-margin to use the pseudoelement but it doesn't work in Safari */

    /* so instead use the layered background image trick */
    &:not(.variant-option__button-label--has-swatch):has([data-option-available='false']) {
      border-width: 0;
    }

    /* ::after/::before act as a fake border for the button style variant */

    /* ::after is the unavailable variant border that clips in */
    &:not(.variant-option__button-label--has-swatch)::before,
    &:has([data-option-available='false']):not(.variant-option__button-label--has-swatch)::after {
      content: '';
      position: absolute;
      inset: 0;
      border: var(--options-border-width) solid var(--color-selected-variant-border);
      border-radius: inherit;
      pointer-events: none;
      z-index: 2;
      /* stylelint-disable-next-line plugin/no-unsupported-browser-features */
      clip-path: inset(var(--clip, 0 0 0 0));
    }

    &:has([data-option-available='false']):not(.variant-option__button-label--has-swatch)::before {
      inset: 0;
    }

    &:not(.variant-option__button-label--has-swatch)::before {
      /* stylelint-disable-next-line plugin/no-unsupported-browser-features */
      clip-path: inset(0 0 0 0);
      border-color: var(--color-variant-border);
      inset: calc(var(--options-border-width) * -1);
    }

    &:has(:checked):not(.variant-option__button-label--has-swatch, :has([data-option-available='false']))::before {
      border-color: var(--color-selected-variant-border);
    }

    /* setting left/right accounts for variant buttons of different widths */
    &:not(:has(:checked)):has(~ label > :checked),
    &:has(:checked):has(~ label > [data-previous-checked='true']) {
      .variant-option__button-label__pill {
        right: 0;
        left: unset;
      }
    }

    &:has([data-previous-checked='true']) ~ label:has([data-current-checked='true']),
    &:has(:checked) ~ label {
      .variant-option__button-label__pill {
        left: 0;
        right: unset;
      }
    }

    &:not(:has(:checked)):has(~ label > :checked) {
      --pill-offset: calc(100% + 1px);
    }

    &:has(:checked) ~ label {
      --pill-offset: calc(-100% - 1px);
    }

    &:has([data-current-checked='true']):first-of-type
      ~ label:last-of-type:not(.variant-option__button-label--has-swatch),
    &:not(:has(:checked)):has(~ label > :checked):not(.variant-option__button-label--has-swatch) {
      --clip: 0 0 0 100%;
    }

    &:not(:has([data-current-checked='true'])):first-of-type:has(~ label:last-of-type > :checked):not(
        .variant-option__button-label--has-swatch
      ),
    &:has(:checked) ~ label:not(.variant-option__button-label--has-swatch) {
      --clip: 0 100% 0 0;
    }

    &:has([data-previous-checked='true'], [data-current-checked='true']) .variant-option__button-label__pill {
      width: max(var(--pill-width-current, 100%), var(--pill-width-previous, 100%));
    }

    @media screen and (min-width: 750px) {
      padding: var(--padding-xs) var(--variant-option-padding-inline);
    }
  }

  /* wrap around only for 3 or more variants in a row */

  /* the more complex selector rules here produce the wrap around effect for first/last variants */
  .variant-option--buttons:has(:nth-of-type(3)) {
    .variant-option__button-label:has([data-current-checked='true']):first-of-type ~ label:last-of-type {
      --pill-offset: calc(100% + 1px);
    }

    .variant-option__button-label:not(:has([data-current-checked='true'])):first-of-type:has(
        ~ label:last-of-type > :checked
      ) {
      --pill-offset: calc(-100% - 1px);
    }
  }

  .variant-option__button-label__pill {
    background: var(--color-variant-hover-background);
    position: absolute;
    top: calc(var(--options-border-width) * -1);
    bottom: calc(var(--options-border-width) * -1);
    border-radius: inherit;
    pointer-events: none;
    width: 100%;
    transform: translateX(var(--pill-offset, 0));
  }

  .variant-option__button-label__text {
    pointer-events: none;
    text-align: start;
    text-wrap: auto;
    z-index: 2;
  }

  .variant-option--equal-width-buttons {
    --variant-min-width: clamp(44px, calc(var(--variant-option-padding-inline) * 2 + var(--variant-ch)), 100%);

    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(var(--variant-min-width), 1fr));

    .variant-option__button-label {
      min-width: var(--variant-min-width);
    }

    .variant-option__button-label__text {
      text-align: center;
      text-wrap: balance;
    }
  }

  .variant-option__button-label:has(:focus-visible) {
    --variant-picker-stroke-color: var(--color-foreground);

    border-color: var(--color-foreground);
    outline: var(--focus-outline-width) solid var(--color-foreground);
    outline-offset: var(--focus-outline-offset);
  }

  .variant-option__button-label--has-swatch {
    --focus-outline-radius: var(--variant-picker-swatch-radius);

    padding: 0;
    border: none;
    display: block;
    flex-basis: auto;
    min-height: auto;
  }

  .variant-option__button-label:has(:checked) {
    color: var(--color-selected-variant-text);
    border-color: var(--color-selected-variant-border);
  }

  .variant-option__button-label:has(:checked):hover {
    border-color: var(--color-selected-variant-hover-border);
    color: var(--color-selected-variant-hover-text);

    .variant-option__button-label__pill {
      background-color: var(--color-selected-variant-hover-background);
    }
  }

  .variant-option__button-label:has([data-option-available='false']) {
    color: rgb(var(--color-variant-text-rgb) / var(--opacity-60));
  }

  .facets__inputs-list--swatches-grid .variant-option__button-label--has-swatch:hover .swatch {
    --focus-outline: var(--focus-outline-width) solid rgb(var(--color-foreground-rgb) / var(--opacity-35-55));

    outline: var(--focus-outline);
    outline-offset: var(--focus-outline-offset);
  }

  .facets__inputs-list--swatches-grid .variant-option__button-label:has(:focus-visible) .swatch {
    --focus-outline: var(--focus-outline-width) solid currentcolor;

    outline: var(--focus-outline);
    outline-offset: var(--focus-outline-offset);
  }

  .facets__inputs-list--swatches-grid .variant-option__button-label:has(:focus-visible) {
    outline: none;
  }

  .facets__inputs-list--swatches-grid .variant-option__button-label--has-swatch:hover {
    outline: none;
  }

  .variant-option__button-label--has-swatch:hover {
    outline: var(--focus-outline-width) solid rgb(var(--color-foreground-rgb) / var(--opacity-35-55));
    /* outline-offset: var(--focus-outline-offset); */
  }

  .facets__inputs-list--swatches-grid .variant-option__button-label--has-swatch:has(:checked) {
    --focus-outline: none;
  }

  .facets__inputs-list--swatches-grid .variant-option__button-label--has-swatch:has(:checked) .swatch {
    outline: var(--focus-outline);
    outline-offset: var(--focus-outline-offset);
  }

  .variant-option__button-label--has-swatch:has(:checked) {
    --focus-outline: var(--focus-outline-width) solid var(--color-foreground);

    outline: var(--focus-outline);
    border-bottom: 4px solid black;
    /* outline-offset: var(--focus-outline-offset); */
  }

  /* This triggers iOS < 16.4. The outline bug is not recognized as a lack of @supports */
  @supports not (background-color: rgb(from red 150 g b / alpha)) {
    /** There is a bug in safari < 16.4 that causes the outline to not follow the elements border radius. This is a workaround. **/
    .variant-option__button-label--has-swatch:has(:checked),
    .variant-option__button-label:has(:focus-visible) .swatch,
    .facets__inputs-list--swatches-grid .variant-option__button-label--has-swatch:hover .swatch {
      outline: none;
      position: relative;
      overflow: visible;
    }

    .variant-option__button-label--has-swatch:has(:checked)::after,
    .variant-option__button-label:has(:focus-visible) .swatch::after,
    .facets__inputs-list--swatches-grid .variant-option__button-label--has-swatch:hover .swatch::after {
      content: '';
      position: absolute;
      inset: calc(-1 * var(--focus-outline-offset));
      border: var(--focus-outline);
      border-radius: var(--focus-outline-radius, 50%);
      background-color: transparent;
      display: inherit;
    }
  }

  .variant-option__button-label:has([data-option-available='false']):has(:checked) {
    background-color: inherit;
    color: rgb(var(--color-variant-text-rgb) / var(--opacity-60));
  }

  .variant-option__button-label input,
  .variant-option--images input {
    /* remove the checkbox from the page flow */
    position: absolute;

    /* set the dimensions to match those of the label */
    inset: 0;

    /* hide it */
    opacity: 0;
    margin: 0;
    cursor: pointer;
    width: 100%;
    height: 100%;
  }

  .variant-option__button-label svg {
    position: absolute;
    left: var(--options-border-width);
    top: var(--options-border-width);
    height: calc(100% - (var(--options-border-width) * 2));
    width: calc(100% - (var(--options-border-width) * 2));
    cursor: pointer;
    pointer-events: none;
    stroke-width: var(--style-border-width);
    stroke: var(--variant-picker-stroke-color);
  }

  .variant-option__button-label:not(.variant-option__button-label--has-swatch) svg {
    stroke: var(--color-variant-border);

    line {
      stroke-width: var(--options-border-width);
    }

    line:last-of-type {
      /* stylelint-disable-next-line plugin/no-unsupported-browser-features */
      clip-path: inset(var(--clip, 0 0 0 0));
      stroke: rgb(var(--color-variant-text-rgb) / 1);
    }
  }

  .variant-option__select-wrapper {
    display: flex;
    position: relative;
    border: var(--style-border-width-inputs) solid var(--color-border);
    border-radius: var(--style-border-radius-inputs);
    align-items: center;
    margin-top: var(--margin-2xs);
    overflow: clip;
  }

  .variant-option__select-wrapper:has(.swatch) {
    --variant-picker-swatch-width: 20px;
    --variant-picker-swatch-height: 20px;
  }

  .variant-option__select-wrapper:hover {
    border-color: var(--color-variant-hover-border);
  }

  .variant-option__select:focus-visible {
    outline: var(--focus-outline-width) solid currentcolor;
    outline-offset: var(--focus-outline-offset);
  }

  .variant-option__select {
    padding-block: var(--padding-md);
    padding-inline: var(--padding-lg) calc(var(--padding-lg) + var(--icon-size-2xs));
    appearance: none;
    border: 0;
    width: 100%;
    margin: 0;
    cursor: pointer;
  }

  .variant-option__select-wrapper .icon {
    position: absolute;
    right: var(--padding-md);
    top: 50%;
    transform: translateY(-50%);
    width: var(--icon-size-2xs);
    height: var(--icon-size-2xs);
    pointer-events: none;
  }

  .variant-option__select--has-swatch {
    padding-inline-start: calc((2 * var(--padding-sm)) + var(--variant-picker-swatch-width));
  }

  .variant-option__select-wrapper .swatch {
    position: absolute;
    top: 50%;
    left: var(--padding-md);
    transform: translateY(-50%);
  }

  .variant-picker--center,
  .variant-picker--center .variant-option {
    text-align: center;
    align-items: center;
    justify-content: center;
    width: 100%;
  }

  .variant-picker--right,
  .variant-picker--right .variant-option {
    text-align: right;
    justify-content: right;
  }

  .variant-option--size-guide {
    display: block;

    > legend {
      display: none;
    }
  }

  .variant-size-guide__header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--gap-sm);
    margin: 0 0 16px;
  }

  .variant-size-guide__title {
    font-weight: var(--font-subheading--weight);
    color: var(--color-foreground);
    font-family: var(--font-paragraph--family);
    font-size: var(--font-paragraph--size);
    font-weight: var(--font-accent--weight);
    line-height: 112.5%;
    letter-spacing: .25px;
    text-transform: uppercase;
  }

  .variant-size-guide__link {
    white-space: nowrap;
    color: var(--color-foreground);
    font-family: var(--font-paragraph--family);
    font-size: var(--font-paragraph--size);
    font-weight: var(--font-paragraph--weight);
    line-height: 137.5%;
    letter-spacing: .25px;
    text-decoration-line: underline;
    text-decoration-style: solid;
    text-decoration-skip-ink: auto;
    text-decoration-thickness: auto;
    text-underline-offset: auto;
    text-underline-position: from-font;
    text-transform: unset;
    font-stretch: unset;
  }

  .variant-size-guide__message {
    margin-bottom: var(--margin-xs);
    font-size: var(--font-size--md);
    background-color: var(--background-color-message);
    color: var(--color-foreground);
    line-height: 22px;
    letter-spacing: .25px;
    padding: 9px 10px 5px;
  }

  .variant-size-guide__options {
    display: flex;
    flex-wrap: wrap;
    gap: var(--gap-sm);
  }

  .variant-option__button-label--size-guide-modal .svg-wrapper {
    width: var(--icon-size-sm);
    height: var(--icon-size-sm);
  }

  .variant-size-guide__icon-svg {
    display: inline-flex;
    width: 11px;
    height: 20px;
    color: currentcolor;
    position: relative;
  }

  .variant-size-guide__icon-svg svg {
    width: 100%;
    height: 100%;
  }

  .variant-size-guide__icon-svg svg path {
    fill: none;
    stroke: currentColor;
  }

  .variant-size-guide__modal {
    container-type: inline-size;
  }

  .variant-size-guide__modal:not(.variant-size-guide__modal--drawer) {
    background-color: var(--color-variant-background);
    color: var(--color-variant-text);
    border-radius: var(--style-border-radius-popover);
    border: var(--style-border-popover);
    box-shadow: var(--shadow-popover);
    width: min(980px, calc(100vw - var(--padding-xl) * 2));
    max-height: var(--modal-max-height);
    padding: var(--padding-xl);
    margin: auto;
  }

  .variant-size-guide__modal--drawer {
    background-color: var(--color-variant-background);
    color: var(--color-variant-text);
    border: var(--style-border-popover);
    border-radius: 0;
    box-shadow: var(--shadow-popover);
    position: fixed;
    width: var(--sidebar-width);
    max-width: 95vw;
    height: 100%;
    margin: 0 0 0 auto;
    padding: 60px 20px;
  }

  .variant-size-guide__modal--drawer:modal {
    max-height: 100dvh;
  }

  .variant-size-guide__modal--drawer[open] {
    --start-x: 100%;
    --end-x: 0px;
    --start-opacity: 1;
  }

  .variant-size-guide__modal--drawer[open].dialog-closing {
    --start-x: 0px;
    --end-x: 100%;
    --start-opacity: 1;
    --end-opacity: 1;
  }

  .variant-size-guide__modal:not(.variant-size-guide__modal--drawer)[open] {
    animation: modalSlideInTop var(--animation-speed) var(--animation-easing) forwards;
  }

  .variant-size-guide__modal:not(.variant-size-guide__modal--drawer).dialog-closing {
    animation: modalSlideOutTop var(--animation-speed) var(--animation-easing) forwards;
  }

  .variant-size-guide__modal-content {
    padding-right: var(--padding-xl);
  }

  .variant-size-guide__modal-close {
    top: var(--margin-2xs);
    right: var(--margin-2xs);
  }

  .variant-color-options {
    width: 100%;
    margin: 7px 0 0;
  }

  .variant-color-options__trigger {
    width: 100%;
    min-height: 42px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--gap-sm);
    padding: 10px 14px;
    border: 1px solid var(--color-selected-variant-hover-border);
    border-radius: var(--style-border-radius-inputs);
    background-color: transparent;
    color: var(--color-foreground);
    text-align: left;
  }

  .variant-color-options__trigger:hover {
    border-color: var(--color-selected-variant-hover-border);
  }

  .variant-color-options__trigger-text {
    font-size: var(--font-size--md);
    font-weight: var(--font-weight-ExtraBold, 800);
    line-height: 112.5%;
    letter-spacing: .25px;
    text-transform: uppercase;
  }

  .variant-color-options__icon {
    display: inline-flex;
    width: 8px;
    height: 14px;
    flex-shrink: 0;
  }

  .variant-color-options__icon svg {
    width: 100%;
    height: 100%;
  }

  .variant-color-options__modal {
    container-type: inline-size;
    background-color: var(--color-variant-background);
    color: var(--color-variant-text);
  }

  .variant-color-options__modal--drawer {
    border: var(--style-border-popover);
    border-radius: 0;
    box-shadow: var(--shadow-popover);
    position: fixed;
    width: var(--sidebar-width);
    max-width: 95vw;
    height: 100%;
    margin: 0 0 0 auto;
    padding: 60px 20px;
  }

  .variant-color-options__modal--drawer:modal {
    max-height: 100dvh;
  }

  .variant-color-options__modal--drawer[open] {
    --start-x: 100%;
    --end-x: 0px;
    --start-opacity: 1;
  }

  .variant-color-options__modal--drawer[open].dialog-closing {
    --start-x: 0px;
    --end-x: 100%;
    --start-opacity: 1;
    --end-opacity: 1;
  }

  .variant-color-options__modal-content {
    padding-right: var(--padding-xl);
  }

  .variant-color-options__modal-close {
    top: var(--margin-2xs);
    right: var(--margin-2xs);
  }
{% endstylesheet %}
