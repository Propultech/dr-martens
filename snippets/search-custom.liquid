{%- doc -%}
  Renders a custom inline search component with predictive search.
  Mobile: Button that expands a search panel below
  Desktop: Inline search input

  @param {string} [placeholder] - The placeholder text for the search input.
  @param {string} [class] - Additional classes for the search container.
  @param {string} [unique_id] - Unique identifier for multiple instances.
  @param {string} [color_scheme] - Color scheme to apply (e.g., 'scheme-1', 'scheme-2').
  @param {string} [mode] - Rendering mode: 'full' (default), 'button-desktop', or 'panel'.

  @example
  {% render 'search-custom', placeholder: 'Busca productos...', class: 'custom-class', unique_id: 'header', color_scheme: 'scheme-1', mode: 'button-desktop' %}
{%- enddoc -%}

{%- liquid
  assign section_id = unique_id | default: 'inline'
  assign placeholder_text = placeholder | default: 'Busca botas, zapatos, sandalias y m√°s'

  # Determine what to render based on mode
  # mode: 'full' (default) = button + desktop + panel
  # mode: 'button-desktop' = only button + desktop (no panel)
  # mode: 'panel' = only mobile panel
  assign render_mode = mode | default: 'full'

  # Determine what to render
  if render_mode == 'panel'
    assign should_render_mobile_panel = true
    assign should_render_button_desktop = false
  elsif render_mode == 'button-desktop'
    assign should_render_mobile_panel = false
    assign should_render_button_desktop = true
  else
    # mode: 'full' - render everything
    assign should_render_mobile_panel = true
    assign should_render_button_desktop = true
  endif
-%}

{%- if should_render_button_desktop -%}
<search-custom-component class="search-custom-wrapper{% if class != blank %} {{ class | strip }}{% endif %}" data-unique-id="{{ section_id }}">
  {%- comment -%} Mobile: Toggle button only (panel rendered separately in header row) {%- endcomment -%}
  <button
    type="button"
    class="search-custom-mobile__trigger color-{{ color_scheme }} desktop:hidden"
    aria-label="{{ 'content.search_input_label' | t }}"
    aria-expanded="false"
    aria-controls="search-custom-mobile-panel-{{ section_id }}"
    ref="mobileTrigger"
  >
    <span class="search-custom-mobile__icon search-custom-mobile__icon--search" aria-hidden="true" ref="searchIcon">
      {{ 'icon-search.svg' | inline_asset_content }}
    </span>
    <span class="search-custom-mobile__icon search-custom-mobile__icon--close" aria-hidden="true" ref="closeIcon" hidden>
      {{ 'icon-close.svg' | inline_asset_content }}
    </span>
  </button>

  {%- comment -%} Desktop: Inline search {%- endcomment -%}
  <div class="search-custom-desktop color-{{ color_scheme }} mobile:hidden">
    <predictive-search-component
      class="predictive-search-component"
      data-section-id="search-custom-desktop-{{ section_id }}"
    >
      <form action="{{ routes.search_url }}" method="get" role="search" class="search-custom-form">
        <div class="search-custom-input-wrapper">
          <span class="search-custom-icon search-custom-icon--search" aria-hidden="true">
            {{ 'icon-search.svg' | inline_asset_content }}
          </span>

          <button
            type="reset"
            ref="resetButton"
            class="search-custom-clear"
            aria-label="{{ 'actions.clear' | t }}"
            hidden
          >
            <span class="svg-wrapper" aria-hidden="true">
              {{ 'icon-close.svg' | inline_asset_content }}
            </span>
          </button>

          <label for="search-custom-desktop-input-{{ section_id }}" class="visually-hidden">
            {{ 'content.search_input_label' | t }}
          </label>

          <input
            id="search-custom-desktop-input-{{ section_id }}"
            ref="searchInput"
            type="search"
            name="q"
            value="{{ search.terms | escape }}"
            placeholder="{{ placeholder_text }}"
            class="search-custom-input"
            role="combobox"
            aria-expanded="false"
            aria-owns="search-custom-desktop-results-{{ section_id }}"
            aria-controls="search-custom-desktop-results-{{ section_id }}"
            aria-haspopup="listbox"
            aria-autocomplete="list"
            autocomplete="off"
          />
        </div>

        <input name="options[prefix]" type="hidden" value="last" />
      </form>

      <div
        id="search-custom-desktop-results-{{ section_id }}"
        ref="predictiveSearchResults"
        class="search-custom-results"
        tabindex="-1"
        hidden
      ></div>
    </predictive-search-component>
  </div>
</search-custom-component>
{%- endif -%}

{%- if should_render_mobile_panel -%}
  {%- comment -%} Mobile panel {%- endcomment -%}
  <div
    id="search-custom-mobile-panel-{{ section_id }}"
    class="search-custom-mobile-panel desktop:hidden color-{{ color_scheme }}"
    hidden
    ref="mobilePanel"
    data-mobile-panel="true"
  >
  <predictive-search-component
    class="predictive-search-component"
    data-section-id="search-custom-mobile-{{ section_id }}"
  >
    <form action="{{ routes.search_url }}" method="get" role="search" class="search-custom-form">
      <div class="search-custom-input-wrapper">
        <label for="search-custom-mobile-input-{{ section_id }}" class="visually-hidden">
          {{ 'content.search_input_label' | t }}
        </label>

        <button
          type="reset"
          ref="resetButton"
          class="search-custom-reset"
          aria-label="{{ 'actions.clear' | t }}"
          hidden
        >
            <span class="svg-wrapper" aria-hidden="true">
                {{ 'icon-close.svg' | inline_asset_content }}
            </span>
        </button>

        <span class="search-custom-button" aria-hidden="false" ref="searchIcon">
            {{ 'icon-search.svg' | inline_asset_content }}
        </span>

        <input
          id="search-custom-mobile-input-{{ section_id }}"
          ref="searchInput"
          type="search"
          name="q"
          value="{{ search.terms | escape }}"
          placeholder="{{ placeholder_text }}"
          class="search-custom-input"
          role="combobox"
          aria-expanded="false"
          aria-owns="search-custom-mobile-results-{{ section_id }}"
          aria-controls="search-custom-mobile-results-{{ section_id }}"
          aria-haspopup="listbox"
          aria-autocomplete="list"
          autocomplete="off"
        />

      </div>

      <input name="options[prefix]" type="hidden" value="last" />
    </form>

    <div
      id="search-custom-mobile-results-{{ section_id }}"
      ref="predictiveSearchResults"
      class="search-custom-results"
      tabindex="-1"
      hidden
    ></div>
  </predictive-search-component>
</div>
{%- endif -%}

{% stylesheet %}
.header-search-custom {
    .visually-hidden {
        position: absolute !important;
        height: 0px;
        width: 0px;
        overflow: hidden;
        clip: rect(1px, 1px, 1px, 1px);
        white-space: nowrap;
        visibility: hidden;
    }

    .search-custom-wrapper {
        display: flex;
        align-items: center;
        justify-content: center;

        .search-custom-form {
            display: flex;
            align-items: center;
            height: 40px;
            width: clamp(300px, 27.5vw, 396px);
            background-color: var(--color-background);
            padding: 6px;

            .search-custom-input-wrapper {
                display: flex;
                gap: 6px;
                position: relative;
                width: 100%;

                .search-custom-icon {
                    display: block;
                    width: 28px;
                    height: 28px;
                }

                &:has(.search-custom-clear:not([hidden])) {
                    .search-custom-icon {
                        display: none;
                    }
                }

                .search-custom-clear {
                    background-color: transparent;
                    border: none;
                    cursor: pointer;
                    padding: 0;
                    color: var(--color-foreground);
                    width: 28px;
                    height: 28px;
                }

                .search-custom-input {
                    background-color: var(--color-background);
                    color: var(--color-foreground);
                    border: none;
                    font-size: 16px;
                    line-height: normal;
                    flex: 1;

                    &:focus {
                        outline: none;
                    }

                    &::placeholder {
                        color: var(--color-foreground);
                    }
                }
            }
        }
    }
}

/* mobile  */
.search-custom-mobile__trigger {
    background-color: transparent;
    border: none;
    cursor: pointer;
    padding: 0;
    width: 28px;
    height: 28px;
    display: flex;
    align-items: center;
    justify-content: center;

    &:focus {
        outline: none;
        background-color: transparent;
    }

    .search-custom-mobile__icon {
        display: block;
        color: var(--color-foreground);
        width: 28px;
        height: 28px;

        &.search-custom-mobile__icon--close {
            width: 20px;
            height: 20px;
        }

        &[hidden] {
            display: none;
        }

        svg {
            width: 100%;
            height: 100%;
        }
    }
}

.header__row--mobile {
    background-color: black;
    display: grid;
    grid-template-rows: 1fr;
    overflow: hidden;
    transition: grid-template-rows 0.4s ease, display 0.4s allow-discrete;

    &:has(.search-custom-mobile-panel[hidden]) {
        grid-template-rows: 0fr;
    }

    > div {
        padding: 0 var(--page-margin);
        background-color: transparent;
        overflow: hidden;
    }

    .search-custom-mobile-panel {
        display: block;
        opacity: 1;
        transition: opacity 0.2s ease, display 0.4s allow-discrete;

        &[hidden] {
            display: none;
            opacity: 0;
        }

        @starting-style {
            opacity: 0;
        }
    }

    .predictive-search-component,
    .search-custom-form {
        width: 100%;
        background-color: transparent;
    }

    .search-custom-input-wrapper {
        display: flex;
        width: 100%;
        gap: 6px;
        align-items: center;
        justify-content: center;
        background-color: var(--color-foreground);

        .search-custom-button {
            display: block;
            width: 28px;
            height: 28px;
            color: var(--color-background);
        }

        .search-custom-input {
            background-color: var(--color-foreground);
            color: var(--color-background);
            border: none;
            font-size: 16px;
            line-height: normal;
            flex: 1;
            height: 54px;
            border-radius: 0;

            &:focus {
                outline: none;
            }

            &::placeholder {
                color: var(--color-background);
            }
        }
    }
}

@media screen and (max-width: 749px) {
}

{% endstylesheet %}
